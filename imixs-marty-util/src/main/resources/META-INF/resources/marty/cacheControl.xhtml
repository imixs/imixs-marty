<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:cc="http://java.sun.com/jsf/composite">

<cc:interface>
	<cc:attribute name="redirect"></cc:attribute>
	<cc:attribute name="clear" default="false"
		type="java.lang.Boolean"></cc:attribute>
</cc:interface>

<cc:implementation>

	<c:if test="#{cc.attrs.clear}">
		<!-- Clear browser cache -->
		<f:event type="preRenderView"
			listener="#{browserCacheController.clearCache}" />
	</c:if>

	<c:if test="#{! empty cc.attrs.redirect}">
		<!-- Redirect if cached page -->
		<script type="text/javascript">
		/*<![CDATA[*/
	
		// check for latestCacheID
		if (!isValidCacheID(#{browserCacheController.cacheID})) {
			document.location="#{cc.attrs.redirect}";
		}
		// test cache id to redirect if page comes from browser cache
		function isValidCacheID(currentCacheID) {
			if (!('localStorage' in window && window['localStorage'] !== null))
				return true; // old browsers not supported
			var latestCacheID=localStorage.getItem("org.imixs.latestCacheID");
			if (latestCacheID!=null && currentCacheID<=latestCacheID) {
				return false;
			}
			// set new id
			localStorage.setItem("org.imixs.latestCacheID", currentCacheID);
			return true;
		}

		/*]]>*/
		</script>
	</c:if>



</cc:implementation>


</html>


