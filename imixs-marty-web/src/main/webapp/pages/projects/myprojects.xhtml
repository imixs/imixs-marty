<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:c="http://java.sun.com/jstl/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich"
	template="/layout/template.xhtml">

	<ui:define name="content">
		<f:view>
			<f:loadBundle basename="bundle.project" var="messages" />

			<rich:dragIndicator id="indicator" />

			<h:form id="myprojectsdataForm">
				<div class="sywapp-view sywapp-projectlist">
				<h2><h:outputText value="#{messages.title_my_projects}" /></h2>

				<div class="sywapp-view-body sywapp-projectlist-body">
				<rich:dataList var="myproject" value="#{projectlistMB.mainProjects}"
					rowClasses="sywapp-viewentry">

					<a4j:outputPanel>
						<rich:dragSupport dragIndicator=":indicator" dragType="project"
							dragValue="#{myproject.item['$uniqueid']}">
							<rich:dndParam name="label" value="#{myproject.item['txtname']}" />
						</rich:dragSupport>
						<h:commandLink actionListener="#{projectlistMB.doSwitchToProject}"
							action="open_worklist">
							<h:outputText value="#{myproject.item['txtname']}"
								styleClass="sywapp-viewentry-header" />
						</h:commandLink>
					</a4j:outputPanel>
					<br />
					
					<h:panelGroup rendered="#{! empty myproject.item['txtdescription']}">
						<h:outputText value="#{myproject.item['txtdescription']}" />
						<br />
					</h:panelGroup>

 					<h:outputText value="#{global.modified}: "/>					
					<h:outputText
						value="#{myproject.item['$modified']}">
						<f:convertDateTime type="both" dateStyle="medium" />
					</h:outputText>
					<h:outputText
						value=" #{global.by} #{nameLookupMB.userName[myproject.item['namCurrentEditor']]}" />

					<!--  Process List  -->

					<a4j:outputPanel id="infoBlock2" layout="block">
						<a4j:outputPanel layout="block"
							rendered="#{myproject.item['a4j:showProcessList']}"
							styleClass="sywapp-viewentry-details">
							
							<h3><h:outputText value="#{messages.start_new_process}" /> <a4j:commandLink
								reRender="infoBlock2"
								actionListener="#{projectlistMB.doToggleProcessList}"
								value="#{global.close}"
								style="font-size:10px; font-weight:normal;margin-left:10px;text-transform:uppercase;">
							</a4j:commandLink></h3>						
							
							<ul style="margin-bottom:10px">
								<ui:repeat
									value="#{projectlistMB.processList[myproject.item['$uniqueid']]}"
									var="process">
									<li><h:commandLink action="open_workitem"
										actionListener="#{workitemMB.doCreateWorkitem}"
										value="#{process.item['txtworkflowgroup']}">
										<f:param name="id"
											value="#{process.item['$modelversion']}|#{process.item['numprocessid']}" />
									</h:commandLink></li>
								</ui:repeat>
							</ul>
						</a4j:outputPanel>
					</a4j:outputPanel>


					<!--  Team List  -->

					<a4j:outputPanel id="infoBlock1" layout="block">
						<a4j:outputPanel layout="block"
							rendered="#{myproject.item['a4j:showTeam']}"
							styleClass="sywapp-viewentry-details">
							

							<h3><h:outputText value="#{messages.teamlist}" /> <a4j:commandLink
								reRender="infoBlock1"
								actionListener="#{projectlistMB.doToggleTeam}"
								value="#{global.close}"
								style="font-size:10px; font-weight:normal;margin-left:10px;text-transform:uppercase;">
							</a4j:commandLink></h3>	
							<ul style="margin-bottom:10px">
								<ui:repeat value="#{myproject.itemListArray['namTeam']}"
									var="member">
									<li><h:commandLink
										action="open_profile"
										actionListener="#{profileMB.doSwitchToProfile}"
										value="#{nameLookupMB.userName[member]}">
										<f:param name="id" value="#{member}" />
									</h:commandLink></li>
								</ui:repeat>
							</ul>
						</a4j:outputPanel>
					</a4j:outputPanel>



					<ul class="sywapp-viewentry-nav">
						<li><h:commandLink
							actionListener="#{projectlistMB.doSwitchToProject}"
							action="open_worklist">
							<h:outputText value="#{messages.open_workitems}" />
						</h:commandLink></li>

						<li><a4j:commandLink id="toggle_start_process_id"
							value="#{messages.start_new_process}"
							reRender="infoBlock2"
							actionListener="#{projectlistMB.doToggleProcessList}">
						</a4j:commandLink></li>


						<li><a4j:commandLink id="toggle_team_command_id"
							value="#{messages.teamlist}"
							reRender="infoBlock1"
							actionListener="#{projectlistMB.doToggleTeam}">
						</a4j:commandLink></li>



						<li><h:commandLink rendered="#{myproject.item['$isAuthor']}"
							actionListener="#{projectlistMB.doEdit}" action="open_project">
							<h:outputText value="#{messages.open_project}" />
						</h:commandLink></li>


						<li><h:commandLink rendered="#{ (myproject.item['$isAuthor']) and (!empty myProfileMB.workitem.item['keyOrderType']) and (!myProfileMB.workitem.item['keyOrderType'] > '0')}"
							actionListener="#{projectlistMB.doCreateSubproject}"
							action="open_project">
							<h:outputText value="#{messages.create_subproject}"/>
						</h:commandLink></li>

					</ul>
				</rich:dataList>
				</div>
				<div class="sywapp-view-footer sywapp-projectlist-footer">

				<h:commandButton actionListener="#{projectlistMB.doLoadPrev}"
					disabled="#{projectlistMB.row==0}" value="#{global.prev}">
				</h:commandButton>

				<h:commandButton actionListener="#{projectlistMB.doLoadNext}"
					disabled="#{projectlistMB.endOfList}" value="#{global.next}">
				</h:commandButton>

				</div>
				</div>
			</h:form>
		</f:view>
	</ui:define>

</ui:composition>
